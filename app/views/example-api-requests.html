<!-- Use this page  as the index for your project -->

<!-- ADDING CUSTOM CSS - Add your custom CSS or Sass in /app/assets/sass/main.scss -->

<!-- Extends the layout from /views/layout.html -->
{% extends 'layout.html' %}
<!--
  In /views/layout.html you can:
    - change the header and footer
    - add custom CSS and JavaScript
-->

<!-- Set the page title -->
{% block pageTitle %}
  Example API requests - Terminology search FHIR API
{% endblock %}

<!-- For adding a breadcrumb -->
<!-- Code examples can be found at https://service-manual.nhs.uk/design-system/components/breadcrumbs -->
{% block beforeContent %}
{% endblock %}

<!-- For adding a back link -->
<!-- Code examples can be found at https://service-manual.nhs.uk/design-system/components/back-link -->
{% block outerContent %}
{% endblock %}

<!-- For adding page content -->
<!-- Page layout code can be found at https://service-manual.nhs.uk/design-system/styles/layout -->
{% block content %}
  <div class="nhsuk-grid-row">
    <div class="nhsuk-grid-column-two-thirds">


      <!-- Change the page title here -->
      <h1>
        Terminology search FHIR API
      </h1>

      <!-- Add your content here -->
      <!-- Styles and components can be found at https://service-manual.nhs.uk/design-system -->

      <p class="nhsuk-lede-text">
        How to search and read clinical terminologies like SNOMED CT using FHIR resources
      </p>
      <nav class="nhsuk-contents-list" role="navigation" aria-label="Pages in this guide">
        <h2 class="nhsuk-u-visually-hidden">Contents</h2>
        <ol class="nhsuk-contents-list__list">
          <li class="nhsuk-contents-list__item" aria-current="page">
            <a class="nhsuk-contents-list__link" href="overview">Overview</a>
          </li>
        <li class="nhsuk-contents-list__item">
          <a class="nhsuk-contents-list__link" href="get-started">Get started</a>
        </li>
        <li class="nhsuk-contents-list__item">
          <a class="nhsuk-contents-list__link" href="fhir">About FHIR APIs</a>
          <li class="nhsuk-contents-list__item">
            <a class="nhsuk-contents-list__link" href="snomed">About SNOMED CT</a>
          </li>
        <li class="nhsuk-contents-list__item">
          <span class="nhsuk-contents-list__current">Example API requests and sandbox</span>
        </li>
        </ol>
      </nav>

<h2>Example API requests and sandbox</h2>

<h3><code>GET</code> ValueSet/$expand</h3>
<P>The most commonly used request. Use the <code>$expand</code> operation to search the full list of codes in a ValueSet.</p>
<p>You can create a more precise search using parameters like <code>filter</code>, which lets you use a term to search a ValueSet. You can constrain your search further using <a href="https://ontoserver.csiro.au/shrimp/ecl_help.html" target="_blank">SNOMED CT Expression Constraint Language (ECL) (opens in a new tab)</a>, which helps to define implicit ValueSets.</p>

<details class="nhsuk-details nhsuk-expander">
  <summary class="nhsuk-details__summary">
    <span class="nhsuk-details__summary-text">
      Read use case
    </span>
  </summary>
  <div class="nhsuk-details__text">
  <h4>Searching for a peanut allergy SNOMED CT code</h4>
  <h5>Scenario</h5>
  <p>Your app records a patient's allergy information and the data needs to be sent to NHS Wales as a SNOMED CT code.</p>
  <p>You can use the ValueSet/$expand operation to search for a term by identifying the ValueSet and using parameters to narrow your search. We'll use 'peanut allergy' as our example.</p>
  <h5>Request and parameters</h5>
  <p><code>GET /ValueSet/$expand?filter=&peanut&url=http://example.url</code></p>
  <ul>
    <li>the <code>filter</code> parameter is the term that you're searching within the ValueSet, in this case 'peanut'</li>
    <li>the <code>url</code> parameter identifies the ValueSet to search in</li>
  </ul>
  <h5>Identifying the ValueSet</h5>
  <p>Your next step is constaining the vast number of SNOMED CT codes to a ValueSet that contains only the codes for allergies. Organisations can define their own ValueSets, but you may find it simpler to use the <a href="https://www.hl7.org/fhir/snomedct.html#implicit" target="_blank">implicit ValueSets for SNOMED CT (opens in a new tab)</a>.</p>
  <p>SNOMED CT implicit ValueSets are not already defined. They are implied by the <code>url</code> parameter that is used to identify the ValueSet. For the <code>url</code> parameter, use the SNOMED CT url and add a <code>fhir_vs</code> query parameter, for example:</p>
<ul>
  <li><code> http://snomed.info/sct?fhir_vs</code> identifies an implicit ValueSet that contains all SNOMED CT codes</li>
  <li><code> http://snomed.info/sct?fhir_vs=ecl/<419199007</code> identifies an implicit ValueSet that contains only allergies - <code><419199007</code> in SNOMEC CT ECL means all child concepts related to the ValueSet code for 'allergy to substance'</li>
  </ul>
<h5>Result</h5>
<p>The request to find the SNOMED CT code for a peanut allergy in a ValueSet containing all allergy codes is:</p>
<p><code>GET /ValueSet/$expand?filter=peanut&url=http://snomed.info/sct?fhir_vs=ecl/<419199007</code>

<p>The response is the filtered ValueSet resource, and the <code>contains</code> element is an array containing all matching codes. In this example, there is only one matching code:</p>
<p><code>{
    <br>   "system":  "http://snomed.info/sct",
    <br>   "code":   "91935009",
    <br>   "display":   "Allergy to peanut"
    <br>}</code></p>
    <p>So, the code for a peanut allergy is 91935009.</p>
  </div>
</details>

<details class="nhsuk-details nhsuk-expander">
  <summary class="nhsuk-details__summary">
    <span class="nhsuk-details__summary-text">
      View request and parameters
    </span>
  </summary>
  <div class="nhsuk-details__text">
    <h4>Request</h4>
    <p><code>GET https://sandbox.api.nhs.wales/wrds/fhir-terminology/ValueSet/$expand[?url][&filter][&count]</code></p>
    <br></br>
    <table role="table" class="nhsuk-table-responsive">
      <caption class="nhsuk-table__caption">Request parameters</caption>
      <thead role="rowgroup" class="nhsuk-table__head">
        <tr role="row">
          <th role="columnheader" class="" scope="col">
            Name
          </th>
          <th role="columnheader" class="" scope="col">
            In
          </th>
          <th role="columnheader" class="" scope="col">
            Required
          </th>
          <th role="columnheader" class="" scope="col">
            Type
          </th>
          <th role="columnheader" class="" scope="col">
            Description
          </th>
        </tr>
      </thead>
      <tbody class="nhsuk-table__body">
        <tr role="row" class="nhsuk-table__row">
          <td role="cell" class="nhsuk-table__cell">
            <span class="nhsuk-table-responsive__heading">Name </span><code>url</code>
          </td>
          <td role="cell" class="nhsuk-table__cell">
            <span class="nhsuk-table-responsive__heading">In </span>query
          </td>
          <td role="cell" class="nhsuk-table__cell">
            <span class="nhsuk-table-responsive__heading">Required </span>false
          </td>
          <td role="cell" class="nhsuk-table__cell">
            <span class="nhsuk-table-responsive__heading">Type </span><code>string</code>
          </td>
          <td role="cell" class="nhsuk-table__cell">
            <span class="nhsuk-table-responsive__heading">Description </span> The uri that identifies the value set to search in
          </td>
        </tr>
        <tr role="row" class="nhsuk-table__row">
          <td role="cell" class="nhsuk-table__cell">
            <span class="nhsuk-table-responsive__heading">Name </span><code>filter</code>
          </td>
          <td role="cell" class="nhsuk-table__cell">
            <span class="nhsuk-table-responsive__heading">In </span>query
          </td>
          <td role="cell" class="nhsuk-table__cell">
            <span class="nhsuk-table-responsive__heading">Required </span>false
          </td>
          <td role="cell" class="nhsuk-table__cell">
            <span class="nhsuk-table-responsive__heading">Type </span><code>string</code>
          </td>
          <td role="cell" class="nhsuk-table__cell">
            <span class="nhsuk-table-responsive__heading">Description </span> The term to search for in the ValueSet
          </td>
        </tr>
        <tr role="row" class="nhsuk-table__row">
          <td role="cell" class="nhsuk-table__cell">
            <span class="nhsuk-table-responsive__heading">Name </span><code>count</code>
          </td>
          <td role="cell" class="nhsuk-table__cell">
            <span class="nhsuk-table-responsive__heading">In </span>query
          </td>
          <td role="cell" class="nhsuk-table__cell">
            <span class="nhsuk-table-responsive__heading">Required </span>false
          </td>
            <td role="cell" class="nhsuk-table__cell">
              <span class="nhsuk-table-responsive__heading">Type </span><code>integer</code>
            </td>
            <td role="cell" class="nhsuk-table__cell">
              <span class="nhsuk-table-responsive__heading">Description </span> The number of results to return
            </td>
        </tr>
      </tbody>
    </table>
        <br></br>
        <h4>Response: 200 OK</h4>
    <p>Success</p>
      </div>
    </div>
    </div>



<div class="nhsuk-card">
  <div class="nhsuk-card__content">
    <h3 class="nhsuk-card__heading">
      Try ValueSet/$expand in the sandbox:
    </h3>
    <ol>
      <li><a href="https://developer.nhs.wales/signin">Sign in or register an account</a></li>
      <li>Subscribe to the <a href="sandbox">sandbox</a></li>
      <li>Return here to try the API</li></ol></div>
      <div class="nhsuk-u-padding-left-4">
<a href="try-expand" target="_blank"><button class="nhsuk-button" type="submit">
        Try ValueSet/$expand request
      </button></a></div>
  </div>




{% endblock %}
